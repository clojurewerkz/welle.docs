---
title: "Connecting to Riak"
layout: article
---

## About this guide

This guide covers:

 * Using Riak's HTTP transport with Welle
 * Using Protocol Buffers (PB) transport
 * Checking connection health

This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a> (including images & stylesheets). The source is available [on Github](https://github.com/clojurewerkz/welle.docs).


## What version of Welle does this guide cover?

This guide covers Welle 1.0.0-alpha4, the most recent pre-release version. Welle is a young project but most of the public API
is fleshed out and will not change before the 1.0 release.


## Introduction

Riak and Welle support two transports: HTTP and Protocol Buffers. They vary in performance characteristics and supported features. For the
purpose of this guide we will concentrate on the HTTP transport. This is what most applications use and it delivers pretty good performance
most applications will be satisfied with.


## Using Riak's HTTP transport

`clojurewerkz.welle.core/connect!` function connects to Riak using [HTTP transport](http://wiki.basho.com/HTTP-API.html) and sets up the default client. You can invoke it in
three ways:

{% gist 8e434397887f5c88be23 %}

It is very common to use the 0-arity (first example) in development and the 1-arity (second example) for QA and production environments.
Most of the time, relying on client id to be generated by Welle is sufficient.


## Using Protocol Buffers transport

To connect using the [Protocol Buffers transport](http://wiki.basho.com/PBC-API.html), use `clojurewerkz.welle.core/connect-via-pb!` function:

{% gist 0200cfb36a6d01fcf033 %}


## Checking connection health

To check connection health, use `clojurewerkz.welle.core/ping` function. It takes no arguments and always returns nil.

If Riak is not reachable, a `java.io.IOException` will be thrown.


## Differences between two transports

As far as Welle API goes, you don't have to change anything besides using `clojurewerkz.welle.core/connect-via-pb!` instead of `clojurewerkz.welle.core/connect!`
to go from one transport to the other. However, PB transport has certain limitations, for example, it does not support secondary indexes (2i).
So if you try to use 2i features with the PB transport, an exception will be raised.


## What to read next

The documentation is organized as a number of guides, covering all kinds of topics.

We recommend that you read the following guides first, if possible, in this order:

 * [Working with buckets](/articles/buckets.html)
 * [Storing values](/articles/inserting.html)
 * [Fetching values](/articles/querying.html)
 * [Secondary indexes](/articles/2i.html)
 * [Deleting values](/articles/deleting.html)
 * [Map/Reduce](/articles/mapreduce.html)
 * [Riak search](/articles/search.html)
 * [Integration with 3rd party libraries](/articles/integration.html)



## Tell Us What You Think!

Please take a moment to tell us what you think about this guide on Twitter or the [Welle mailing list](https://groups.google.com/forum/#!forum/clojure-riak)

Let us know what was unclear or what has not been covered. Maybe you do not like the guide style or grammar or discover spelling mistakes. Reader feedback is key to making the documentation better.
